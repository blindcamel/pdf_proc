version: 1.0
runtime: python311
build:
  commands:
    pre-build:
      - wget -c https://pdfprocs3.s3.us-west-2.amazonaws.com/app/pdf_proc_image_033025.tar -O - | tar -xz

    build:
      - pip3 install -r requirements.txt
run:
  command: uvicorn main:app --host 0.0.0.0 --port 8080
  network:
    port: 8080
    env: HTTP
  env:
    - name: OPENAI_API_KEY
      value: ${OPENAI_API_KEY}
    - name: OPENAI_ASSISTANT_ID
      value: ${OPENAI_ASSISTANT_ID}
  secrets:
    - name: prod/pdf_proc/openai_api_keys
      value-from: "arn:aws:secretsmanager:us-west-2:834313359867:secret:prod/pdf_proc/openai_api_keys-MEwzS3"
